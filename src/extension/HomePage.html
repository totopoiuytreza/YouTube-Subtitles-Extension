<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Document</title>
</head>
<body>
    <header>
        <img src="icons/logo.jpg" alt="">
        <h1>Youtube Transcriber</h1>
        <h2>Mettez des sous-titres à vos vidéos</h2>
    </header>
    
    <div class="search-bar">
        <input type="text" id="searchInput" class="search-input" placeholder="URL de la vidéo Youtube...">
        <button id="searchButton" class="search-button">Rechercher</button>
    </div>

    </div class="video-container">
        <iframe id="videoSource" width="75%" height="500"></iframe>
    </div>
      
    <div id="subtitlesContainer">
            <!--    Boite où l'on affiche le texte à droite       -->
            <h2>Transcription</h2>
            <div class="subtitles"></div>
    </div>
</body>
</html>

<script>
    // Récupérez les éléments HTML nécessaires
    var searchInput = document.getElementById('searchInput');
    var searchButton = document.getElementById('searchButton');
    var videoSource = document.getElementById('videoSource');
    var subtitlesTrack = document.getElementById('subtitlesTrack');
    var videoId
    var language_to_transcribe = "fr";

    // Fonction pour extraire l'ID de la vidéo à partir de l'URL YouTube
    function extractVideoId(url) {
            var videoId = "";
            var splitUrl = url.split("v=");
            if (splitUrl.length > 1) {
                videoId = splitUrl[1];
            }
            return videoId;
        }

    //Fonction pour récupérer le texte et l'afficher au moment du click
    function transcribingAll() {
        fetch('http://127.0.0.1:5000/transcribeAll', {
            method: 'POST',
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                video_id: videoId,
                language: language_to_transcribe
            })
        })
        .then(response => response.text())
        .then(data => {
            // Afficher les données dans la balise subtitles
            console.log(JSON.parse(data).text);
             // Sélectionner l'élément <div> des sous-titres
            var subtitlesDiv = document.querySelector('.subtitles');

            // Mettre à jour le contenu de l'élément avec les sous-titres
            var tempSubtitles = JSON.parse(data).text;
            var replacedStr = tempSubtitles.replace(/\n/g, "<br>");
            subtitlesDiv.textContent = replacedStr;
        })
        .catch(error => {
            console.error(error);
        });
    }
    function test() {
        fetch('http://127.0.0.1:5000/test', {
            method: 'POST',
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                video_id: videoId,
                language: language_to_transcribe
            })
        })
        .then(response => response.text())
        .then(data => {
            var subtitlesDiv = document.querySelector('.subtitles');

            // Mettre à jour le contenu de l'élément avec les sous-titres
            subtitlesDiv.textContent = data;
        
        })
        .catch(error => {
            console.error(error);
        });
    }

    // Ajoutez un gestionnaire d'événement au bouton de recherche
    searchButton.addEventListener('click', function(event) {
            event.preventDefault();
            // Récupérez la valeur de recherche de l'utilisateur
            var videoUrl = searchInput.value;
            
           
            videoId = extractVideoId(videoUrl);
            
            // Mettez à jour l'URL de la source vidéo
            videoSource.src = "https://www.youtube.com/embed/" + videoId;
            
            // Appel du transcribeAll
            transcribingAll();
            // Mettez à jour l'URL du sous-titre
            //var vttUrl = "/subtitles.vtt";
            //subtitlesTrack.src = vttUrl;
            
            // Rafraîchissez la vidéo pour prendre en compte les changements
            //document.getElementById('myVideo').load();
            
            
        });

        
</script>